# 任务管理页面产品文档

## 一、接口对接说明

### 1. 获取任务列表 (GET /api/tasks)
- **功能**：获取当前用户的所有任务
- **请求参数**：
  - `start_date`：开始日期（可选）
  - `end_date`：结束日期（可选）
  - `type`：任务类型（可选，可选值：工作、学习、复盘）
  - `is_important`：是否重要（可选，布尔值）
  - `is_urgent`：是否紧急（可选，布尔值）
- **返回数据**：
  ```typescript
  {
    id: string
    content: string
    description: string | null
    type: '工作' | '学习' | '复盘'
    is_important: boolean
    is_urgent: boolean
    start_date: string
    end_date: string
    created_at: string
    updated_at: string
    owner: string
  }[]
  ```

### 2. 获取任务详情 (GET /api/tasks/[id])
- **功能**：根据任务ID获取单个任务的详细信息
- **路径参数**：
  - `id`：任务ID
- **返回数据**：与获取任务列表的单个任务数据结构相同
- **错误响应**：
  - 404：任务不存在
  - 401：未认证
  - 500：服务器错误

### 3. 搜索任务 (GET /api/tasks/search)
- **功能**：根据关键词搜索任务
- **请求参数**：
  - `keyword`：搜索关键词（必填）
- **返回数据**：与获取任务列表的数据结构相同
- **搜索范围**：
  - 任务内容（content）
  - 任务描述（description）
- **排序**：按创建时间倒序
- **错误响应**：
  - 400：缺少搜索关键词
  - 401：未认证
  - 500：服务器错误

### 4. 创建任务 (POST /api/tasks)
- **功能**：创建新任务
- **请求参数**：
  ```typescript
  {
    content: string          // 必填，任务内容
    description?: string     // 可选，任务描述
    type: string            // 必填，任务类型（工作、学习、复盘）
    is_important: boolean   // 必填，是否重要
    is_urgent: boolean      // 必填，是否紧急
    start_date: string      // 必填，开始日期
    end_date: string        // 必填，结束日期
  }
  ```

### 5. 更新任务 (PUT /api/tasks/[id])
- **功能**：更新现有任务
- **路径参数**：
  - `id`：任务ID
- **请求参数**：与创建任务相同
- **错误响应**：
  - 403：无权修改此任务
  - 401：未认证
  - 500：服务器错误

### 6. 删除任务 (DELETE /api/tasks/[id])
- **功能**：删除指定任务
- **路径参数**：
  - `id`：任务ID
- **错误响应**：
  - 403：无权删除此任务
  - 401：未认证
  - 500：服务器错误

## 二、页面功能点

### 1. 页面布局
- 左侧边栏（app-sidebar）：提供导航功能。
- 主内容区：显示任务管理相关内容

### 2. 任务列表展示
- 使用时间线（Timeline）组件展示任务
- 按创建时间倒序排列
- 实时更新：通过 Supabase 实时订阅功能实现
- 任务卡片横跨对应日期范围
- 列宽保持一致
- Timeline 组件铺满右侧区域

### 3. 任务搜索功能
- 使用专门的搜索接口进行任务搜索
- 支持按任务内容和描述进行模糊搜索
- 搜索结果实时显示在下拉列表中
- 点击搜索结果自动定位到对应日期
- 搜索防抖优化（300ms）
- 空关键词时自动加载所有任务

### 4. 任务操作
- **新建任务**：
  - 点击时间轴空白区域打开抽屉
  - 使用 Radio Group 选择任务类型
  - 使用中文日期选择器
  - 添加优先级标题
  - 保存时显示 loading 状态

- **编辑任务**：
  - 点击任务卡片打开编辑抽屉
  - 完整回显任务内容
  - 使用 Radio Group 选择任务类型
  - 使用中文日期选择器
  - 添加优先级标题
  - 保存时显示 loading 状态

- **删除任务**：
  - 在任务详情抽屉中提供删除按钮
  - 删除后自动更新列表

### 5. 任务属性
- **基本信息**：
  - 内容（必填）
  - 描述（选填）
  - 类型（工作/学习/复盘，使用 Radio Group）
  
- **时间信息**：
  - 开始日期（中文显示）
  - 结束日期（中文显示）
  
- **优先级**：
  - 重要程度（是/否）
  - 紧急程度（是/否）

### 6. 用户体验优化
- 加载状态显示
- 错误处理和提示
- 实时数据同步
- 响应式布局
- 保存操作反馈
- 日期导航按钮优化（Figma 风格设计）

### 7. 安全性
- 用户认证检查
- 任务所有权验证
- 数据访问权限控制

## 三、技术实现特点
1. 使用 Next.js 13+ 的 App Router 架构
2. 采用 Supabase 作为后端服务
3. 实现实时数据同步
4. 使用 React Hooks 管理状态
5. 采用 TypeScript 确保类型安全
6. 使用 Tailwind CSS 实现响应式设计
7. 优化搜索性能，使用专门的搜索接口
8. 使用 shadcn/ui 组件库实现统一的设计风格

